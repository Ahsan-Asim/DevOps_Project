version: '3.8'

services:
  mongodb:
    image: mongo
    container_name: mongodb
    ports:
      - "27017:27017"
    volumes:
      - mongo-data:/data/db

  cms-backend:
    build:
      context: ./CMS_Backend/server  # Ensure this points to the correct directory
    container_name: cms-backend
    ports:
      - "3001:3001"
    volumes:
      - ./CMS_Backend/server:/app  # Bind mount for hot reloading
      - /app/node_modules    # Ensure node_modules inside container is not overwritten
    environment:
      - NODE_ENV=development

  cms-frontend:
    build:
      context: ./CMS_Frontend/frontend
    container_name: cms-frontend
    ports:
      - "3000:80"
    volumes:
      - ./CMS_Frontend/frontend:/app  # Bind mount for hot reloading
    # Use the custom Nginx configuration
    depends_on:
      - cms-backend  # Ensure the backend is started before the frontend

  nginx:
    image: nginx:latest
    container_name: nginx
    ports:
      - "80:80"  # Map port 80 of the host to port 80 of the container
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/conf.d/default.conf  # Mount the Nginx config
      - ./CMS_Frontend/frontend/build:/app/build  # Ensure Nginx serves the build files

volumes:
  mongo-data:

